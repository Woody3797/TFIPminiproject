<app-header></app-header>
<br>
<div id="container" class="container mt-3 mw-80">
    <aside>
        <header>
            <h2>Conversations</h2>
        </header>
        <ul>
            <li *ngFor="let id of chatIDs" (click)="selectRecipient(id)">
                <h3 #convoID>{{ id }}</h3>
			</li>
        </ul>
    </aside>
    <main>
        <header>
            <img *ngIf="profileImage; else noImage" src="{{ profileImage }}" style="object-fit: scale-down;" max-height="100px">
            <div>
                <h2 *ngIf="recipient; else noRecipient">
                    Chatting with {{ recipient }} about Product: <span *ngIf="product">{{ product.productName }}</span>
                </h2>
            </div>
        </header>
        <div *ngIf="recipient;else noChat" class="chatwindow">
            <ul id="chat" #chat [scrollTop]="chat.scrollHeight">
                <li *ngFor="let message of messages" [ngClass]="message.sender == email ? 'me' : 'you'">
                    <div class="entete">
                        <h3>{{ message.timestamp | date:'ccc d LLL y, h:mm:ss a' }}</h3>
                    </div>
                    <div class="message">
                        {{ message.content }}
                    </div>
                </li>
            </ul>
            <footer>
                <textarea placeholder="Type your message" #chatMessage (keydown.enter)="sendMessage(chatMessage.value);false" [formControl]="messageInput"></textarea>
                <button mat-raised-button class="button" (click)="sendMessage(chatMessage.value)" type="submit" [disabled]="messageInput.invalid">Send</button>
            </footer>

        </div>
    </main>
</div>

<ng-template #noImage>
    <img class="profilepic" src="/assets/profilepic.png">
</ng-template>
<ng-template #noRecipient>
    <h3>SELECT A PERSON FROM THE CONVERSATIONS BAR</h3>
</ng-template>
<ng-template #noChat>
    
</ng-template>